<div class="container mt-4">
    <!-- Mensaje de error -->
    <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
    </div>
    <!-- Mensaje de éxito -->
    <div *ngIf="successMessage" class="alert alert-success">
        {{ successMessage }}
    </div>
    <!-- Indicador de carga -->
    <div *ngIf="loading" class="text-center my-3">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Guardando...</span>
        </div>
        <div>Guardando...</div>
    </div>
    <div class="row justify-content-center g-4">
        <div class="d-flex justify-content-center mb-4">
            <h2 class="mb-0"><strong>{{ isNew ? 'Nueva Designación' : 'Editar Designación' }}</strong></h2>
        </div>
        <form #form="ngForm" class="row g-3" (ngSubmit)="save()" novalidate>
            <!-- Columna izquierda -->
            <div class="col-md-6">
                <!-- Vigencia Desde -->
                <div class="form-group mt-3">
                    <label class="form-label fw-semibold">Vigencia Desde</label>
                    <div class="input-group">
                        <input class="form-control" placeholder="aaaa/mm/dd" name="fechaInicio" ngbDatepicker
                            #d1="ngbDatepicker" [(ngModel)]="fechaInicioModel" required>
                        <button class="btn btn-outline-secondary" (click)="d1.toggle()" type="button">
                            <i class="fa fa-calendar"></i>
                        </button>
                    </div>
                </div>
                <!-- Situación Revista -->
                <div class="form-group mt-3">
                    <label class="form-label fw-semibold">Situación Revista</label>
                    <input type="text" class="form-control" [(ngModel)]="designacion.situacionRevista"
                        name="situacionRevista" required>
                </div>
                <!-- Persona -->
                <div class="form-group mt-3">
                    <label class="form-label fw-semibold">Persona</label>
                    <input class="form-control" [(ngModel)]="designacion.persona" name="persona"
                        placeholder="Buscar persona" [ngbTypeahead]="buscarPersonas" [editable]="false"
                        [resultFormatter]="resultFormatPersonas" [inputFormatter]="inputFormatPersonas"
                        (selectItem)="onPersonaSelect($event)" required>
                </div>
                <!-- Detalles de la persona -->
                <div class="card mt-3 shadow-sm border-0" *ngIf="designacion.persona?.dni">
                    <div class="card-body p-3 text-secondary">
                        <p><strong>Nombre:</strong> {{ designacion.persona?.nombre }}</p>
                        <p><strong>Apellido:</strong> {{ designacion.persona?.apellido }}</p>
                        <p><strong>DNI:</strong> {{ designacion.persona?.dni }}</p>
                    </div>
                </div>
            </div>
            <!-- Columna derecha -->
            <div class="col-md-6">
                <!-- Vigencia Hasta -->
                <div class="form-group mt-3">
                    <label class="form-label fw-semibold">Vigencia Hasta<small class="text-muted ms-1">(opcional)</small></label>
                    <div class="input-group">
                        <input class="form-control" placeholder="aaaa/mm/dd" name="fechaFin" ngbDatepicker
                            #d2="ngbDatepicker" [(ngModel)]="fechaFinModel">
                        <button class="btn btn-outline-secondary" (click)="d2.toggle()" type="button">
                            <i class="fa fa-calendar"></i>
                        </button>
                    </div>
                </div>
                <!-- Cargo -->
                <div class="form-group mt-3">
                    <label class="form-label fw-semibold">Cargo</label>
                    <input class="form-control" [(ngModel)]="designacion.cargo" name="cargo" placeholder="Buscar cargos"
                        [ngbTypeahead]="buscarCargos" [editable]="false" [resultFormatter]="resultFormatCargos"
                        [inputFormatter]="inputFormatCargos" (selectItem)="onCargoSelect($event)" required>
                </div>
                <!-- Detalles del cargo -->
                <div class="card mt-3 shadow-sm border-0" *ngIf="designacion.cargo?.id">
                    <div class="card-body p-3 text-secondary">
                        <p><strong>Nombre:</strong> {{ designacion.cargo?.nombre }}</p>
                        <p><strong>Carga Horaria:</strong> {{ designacion.cargo?.cargaHoraria }} hs</p>
                        <p><strong>Tipo:</strong> {{ designacion.cargo?.tipoDesignacion }}</p>
                        <div *ngIf="designacion.cargo?.division?.anio">
                            <p><strong>Año:</strong> {{ designacion.cargo?.division?.anio }}</p>
                            <p><strong>Número:</strong> {{ designacion.cargo?.division?.numDivision }}</p>
                            <p><strong>Turno:</strong> {{ designacion.cargo?.division?.turno }}</p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Botones -->
            <div class="col-12 d-flex justify-content-between mt-4">
                <button type="button" class="btn btn-outline-danger" (click)="goBack()">
                    <i class="fa fa-times"></i> Cancelar
                </button>
                <button type="submit" class="btn btn-success" [disabled]="form.invalid">
                    <i class="fa fa-check"></i> Guardar
                </button>
            </div>
        </form>
    </div>
</div>